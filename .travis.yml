dist: xenial
services:
- postgresql
addons:
  postgresql: '9.4'
before_script:
- psql -U postgres -c "create user board password 'board'"
- psql -U postgres -c "ALTER ROLE board superuser"
- psql -U postgres -c "create database boardDB owner board"
- psql -U postgres -c "ALTER USER board CREATEDB"
language: python
python:
- '3.6'
install:
- pip install -r requirements.txt
- pip install codacy-coverage
- pip install coverage
script:
- cd board
- python ./manage.py makemigrations
- python ./manage.py migrate --run-syncdb
- python ./manage.py test --keepdb
- coverage run --branch --source=. ./manage.py test --keepdb
- coverage xml
- python-codacy-coverage -r coverage.xml
deploy:
  provider: heroku
  app: tryonboard-sprint1
  strategy: git
  api_key:
    secure: OtpLm4e7kY1K91wNpdtZXbNJ9Drchw60AqCpTM7gs1vOVRlShxe8mE99Ufetek2rUeyeDSiCWzwDnmM+OayVbv+8No/NLTok1HWeOgYd1YyeWqQrNO3P9UXswRgBBH62KSc0HBNe8+07Q4+Y8HaZk8ldZ38rws0t47wRJYDSojAOfac0OqNsuD72BOnu4RXgXqi5Hacsv+i/ccYmlvW4zrbSmZ+Suj6nDlSZ7SLeQihD5hRXFGRQM/UiUrS9Gsa6mZIc4yGt6zFWBNdIYKrOPVnfheKcMxhQlh0iRseU1MqN4cARdIIuVkT7hcjI31LvIfgVRnHNpQdo1Y/jBue6kz05UW6B2/Ftwi62ND77KxLRAlDWvlVdqzvpDfZE4ae5EiAZaNYz+h+OaxheNn8+VOiIqwRWg6ytPpcyL+Rr/WDN9cFky6G/ncjJc8Wvf3HVlSNYa46EmqZUBbpkq07ZepY61YcXTyCET/ODxlIhhKsCtGoujjVEqtgI3DGQV+PVcrjf2UqZzPwoY7X0rMXepDvTNblpbgKVHzw2dC9gBPl4RtXGwOvbQBs/xzPWaTyvsnIFTeX2oXTf2L6rNR4VC8igNk/zio/D+Pwwnqt2sxuqKmhp9czXn9L8IHzwNBGPVHeSVG24XQqQIMHF33+8UL2jraExCjxQRpcnTBCHc1I=
