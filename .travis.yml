dist: xenial
services:
- postgresql
addons:
  postgresql: '9.4'
before_script:
- psql -U postgres -c "create user board password 'board'"
- psql -U postgres -c "ALTER ROLE board superuser"
- psql -U postgres -c "create database boardDB owner board"
- psql -U postgres -c "ALTER USER board CREATEDB"
language: python
python:
- '3.6'
install:
- pip install -r requirements.txt
- pip install codacy-coverage
- pip install coverage
script:
- cd board
- python ./manage.py makemigrations
- python ./manage.py migrate --run-syncdb
- python ./manage.py test --keepdb
- coverage run --branch --source=. ./manage.py test --keepdb
- coverage xml
- python-codacy-coverage -r coverage.xml
deploy:
  provider: heroku
  api_key:
    secure: uFD6+6+NAOpn1qhNN8C+NhACZV0lzLIqG0h/vwbchbQbhVpeUcKQEn5Vi3yB/1gxB722TRIbjyeM4BLN2N0rSgPBQfh0/VmH71ikeGfSSQyzx4jMtSsxH8dHlwgGWUpWnOO7eC8RAhDLgIhpEh4MhtWfwIXrc5w0k5LUVIBHC6cedUWinOCfGwCLiWhI/1VrTIVdQUG/yC2bz32Ht8ISzILDl3DlOFKKMTy/JxYMMPLfUgk1K1+B2GLhDR88IKMEPz/eT7hSsRkR7aVfIwFCJ2Di6Dj037MaxkHKzyyLvdOZvue1E/atw7FDh5mDnsG/Wm3NRglQyN3w3nxgEswbj1No69DREqDu1296MFIAkXVNl8MAJbNO8hYX+N2HVHw0FhC13p0ik7n2uuB0KSgXukPKJLd6X86EpHcCQNCykKFIHwvtojxUK3300S6sIaWIw0etgQqBLLGmOqzdXOxl3c6gRDndp/ZatjTd4iF62NZSI9P/IEMvgmCWG53LzcLz3lwPdCLxQJGlAiBsifc8GlaYr+bcoDj3kmi1U7H6eWvE3ZSZmyQBnCEXujpFjzzHVQX+HoiKnr4Hj+/e68tv8WFN0GSmBLF42uiYobbo9PzsK1Xrun9f3CrQWvUsDy1N+Kj0R59oKvePpwrd50riiCK/OyJMZtugkyWmL9XnFzg=
  app: tryonboard-sprint1
  on:
    repo: Acme-Board/board
